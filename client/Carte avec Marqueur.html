<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte avec Marqueur</title>
    <!-- Inclure Leaflet -->
    <link rel="stylesheet" href="Carte%20avec%20Marqueur_files/leaflet.css">
    <link rel="stylesheet" href="Carte%20avec%20Marqueur_files/style.css">
    <script src="Carte%20avec%20Marqueur_files/leaflet.js"></script>
    <script src="Carte%20avec%20Marqueur_files/mini_framework.js"></script>
    <script src="Carte%20avec%20Marqueur_files/data.js"></script>
    <script src="Carte%20avec%20Marqueur_files/app.js"></script>
    <link rel="shortcut icon" href="Carte%20avec%20Marqueur_files/drone.ico" type="image/x-icon">
</head>

<body>

    <form action="" method="post" id="login_form" class="border" style="display: none;">
        <div>
            <label for="login">Login:</label>
            <input type="text" name="login" value="client1">    
        </div>
        <div>
            <label for="password">Password:</label>
            <input type="password" name="pass">    
        </div>
        
        <button type="submit">Login</button>
    </form>


    <header>
        <img src="Carte%20avec%20Marqueur_files/cropped-logo-delivrone-long-438x80-2.png" alt="logo delivrone">
        <a href="#/unlog">Unlog</a><script src="Carte%20avec%20Marqueur_files/log_bt.js"></script>
    </header>


    <main>

        <div class="divmap">
            <!-- Conteneur de la carte -->
            <div id="map" class="border leaflet-container leaflet-touch leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom" style="position: relative;" tabindex="0"><div class="leaflet-pane leaflet-map-pane" style="transform: translate3d(0px, 0px, 0px);"><div class="leaflet-pane leaflet-tile-pane"><div class="leaflet-layer " style="z-index: 1; opacity: 1;"><div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 18; transform: translate3d(0px, 0px, 0px) scale(1);"><img alt="" src="Carte%20avec%20Marqueur_files/2723_002.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(311px, -91px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2723_004.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(567px, -91px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2724.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(311px, 165px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2724_006.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(567px, 165px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2723_005.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(55px, -91px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2723.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(823px, -91px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2724_003.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(55px, 165px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2724_002.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(823px, 165px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2723_003.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-201px, -91px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2723_006.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1079px, -91px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2724_005.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-201px, 165px, 0px); opacity: 1;"><img alt="" src="Carte%20avec%20Marqueur_files/2724_004.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(1079px, 165px, 0px); opacity: 1;"></div></div></div><div class="leaflet-pane leaflet-overlay-pane"></div><div class="leaflet-pane leaflet-shadow-pane"></div><div class="leaflet-pane leaflet-marker-pane"><img src="Carte%20avec%20Marqueur_files/drone.ico" class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" style="margin-left: -30px; margin-top: -72px; width: 60px; height: 75px; transform: translate3d(555px, 247px, 0px); z-index: 247;" alt="Marker" tabindex="0" role="button"></div><div class="leaflet-pane leaflet-tooltip-pane"></div><div class="leaflet-pane leaflet-popup-pane"></div><div class="leaflet-proxy leaflet-zoom-animated" style="transform: translate3d(1048050px, 697379px, 0px) scale(4096);"></div></div><div class="leaflet-control-container"><div class="leaflet-top leaflet-left"><div class="leaflet-control-zoom leaflet-bar leaflet-control"><a class="leaflet-control-zoom-in" href="#" title="Zoom in" role="button" aria-label="Zoom in" aria-disabled="false"><span aria-hidden="true">+</span></a><a class="leaflet-control-zoom-out" href="#" title="Zoom out" role="button" aria-label="Zoom out" aria-disabled="false"><span aria-hidden="true">−</span></a></div></div><div class="leaflet-top leaflet-right"></div><div class="leaflet-bottom leaflet-left"></div><div class="leaflet-bottom leaflet-right"><div class="leaflet-control-attribution leaflet-control"><a href="https://leafletjs.com/" title="A JavaScript library for interactive maps"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"></path><path fill="#FFD500" d="M0 4h12v3H0z"></path><path fill="#E0BC00" d="M0 7h12v1H0z"></path></svg> Leaflet</a></div></div></div></div>

            <!-- Listes des drones -->
            <div class="drones border">
                <script src="Carte%20avec%20Marqueur_files/drones.js"></script>
            </div>
        </div>

        <div>
            <!-- Cree une commande -->
            <form action="" method="post" id="takeorder">

                <label for="pet-select">Choose a drone:</label>
                <select name="pets" id="pet-select">
                    <script src="Carte%20avec%20Marqueur_files/dronesoption.js"></script>
                    <option value="" selected="selected">--Please choose a Drone--</option>
                    <option value="dog">Dog</option>
                    <option disabled="disabled" value="cat">Cat</option>
                </select>

                <input type="number" placeholder="" step="0.0001" min="-90" max="90">
                <input type="number" placeholder="" step="0.0001" min="-180" max="180">

                <input type="number" placeholder="" step="0.0001" min="-90" max="90">
                <input type="number" placeholder="" step="0.0001" min="-180" max="180">

            </form>

            <!-- listes des commande et status commande -->
            <div class="orders">
                <script src="Carte%20avec%20Marqueur_files/orders.js"></script>
            </div>
        </div>

    </main>

    <!-- Script pour afficher la carte avec un marqueur -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Créer la carte
            var mymap = L.map('map').setView([51.505, -0.09], 13);

            // Ajouter une couche de tuiles OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                // attribution: '   © OpenStreetMap contributors'
            }).addTo(mymap);


            var myIcon = L.icon({
                iconUrl: 'drone.ico',
                iconSize: [60, 75],
                iconAnchor: [30, 72],
                popupAnchor: [0, 0],
                // shadowUrl: 'my-icon-shadow.png',
                // shadowSize: [68, 95],
                // shadowAnchor: [22, 94]
            });

            // Ajouter un marqueur à des coordonnées spécifiques
            var marker = L.marker([51.5, -0.09], { icon: myIcon }).addTo(mymap);

            // Optionnel : Ajouter une popup au marqueur
            // marker.bindPopup("<b>DroneDeux</b><br>This is a popup.").openPopup();
            setInterval(() => {
                // let coord = Object.values(marker.getLatLng());
                // coord[0] += 0.00001;
                // coord[1] += 0.00001;
                // fetch("http://192.168.101.54/drones", {
                fetch("http://192.168.68.93/drones", {

                    method: "GET", // You can change the HTTP method as needed
                    // credentials: "include",
                    // headers: {
                    //     "Content-Type": "application/json",
                    //     "Cookie": "UUID=d181ff0d-d205-4bed-ac54-73596121acaa",
                    // },
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        // console.log("response",response);
                        return response.json(); // You can adjust this based on the expected response type
                    })
                    .then(data => {
                        const drone = data.drones[0];
                        marker.setLatLng([drone.latitude, drone.longitude]);
                        console.log("Success:", drone);
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
            }, 100000);
        });

    </script>

<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>


</body></html>